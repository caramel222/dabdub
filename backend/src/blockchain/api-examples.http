### Blockchain Monitoring Admin API Examples
### Base URL: https://api.dabdub.xyz

### Variables
@baseUrl = https://api.dabdub.xyz
@adminToken = your-admin-jwt-token
@superAdminToken = your-super-admin-jwt-token

### ============================================
### MONITOR MANAGEMENT
### ============================================

### List All Chain Monitors
GET {{baseUrl}}/api/v1/blockchain/monitors
Authorization: Bearer {{adminToken}}

### Expected Response:
# {
#   "monitors": [
#     {
#       "chain": "base",
#       "status": "RUNNING",
#       "lastScannedBlock": 18234560,
#       "latestKnownBlock": 18234567,
#       "blockLag": 7,
#       "healthStatus": "HEALTHY",
#       "scanAge": "8s",
#       "pollingIntervalSeconds": 10,
#       "totalDepositsDetected": 45230,
#       "consecutiveErrors": 0,
#       "estimatedSyncTime": "70s"
#     }
#   ]
# }

###

### Pause Monitor - Base Chain
POST {{baseUrl}}/api/v1/blockchain/monitors/base/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "Scheduled maintenance - upgrading RPC provider infrastructure"
}

###

### Pause Monitor - Polygon Chain
POST {{baseUrl}}/api/v1/blockchain/monitors/polygon/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "Emergency maintenance due to RPC provider issues"
}

###

### Resume Monitor - Base Chain
POST {{baseUrl}}/api/v1/blockchain/monitors/base/resume
Authorization: Bearer {{adminToken}}

###

### Resume Monitor - Polygon Chain
POST {{baseUrl}}/api/v1/blockchain/monitors/polygon/resume
Authorization: Bearer {{adminToken}}

###

### Rescan Blocks - Valid Range
POST {{baseUrl}}/api/v1/blockchain/monitors/base/rescan
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "fromBlock": 18230000,
  "toBlock": 18231000,
  "reason": "RPC endpoint was down between 10:00-10:15 UTC, missed blocks during downtime"
}

###

### Rescan Blocks - Invalid Range (Should Fail)
POST {{baseUrl}}/api/v1/blockchain/monitors/polygon/rescan
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "fromBlock": 50000000,
  "toBlock": 50015000,
  "reason": "Testing validation - this should fail with 400 error"
}

###

### Get Scan History - Base Chain
GET {{baseUrl}}/api/v1/blockchain/monitors/base/scan-history
Authorization: Bearer {{adminToken}}

###

### Get Scan History - Polygon Chain
GET {{baseUrl}}/api/v1/blockchain/monitors/polygon/scan-history
Authorization: Bearer {{adminToken}}

###

### ============================================
### RPC ENDPOINT MANAGEMENT
### ============================================

### List All RPC Endpoints
GET {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{adminToken}}

### Expected Response:
# [
#   {
#     "id": "uuid",
#     "chain": "base",
#     "url": "https://base-mainnet.g.alchemy.com/v2/abc1***xyz9",
#     "providerName": "Alchemy",
#     "isActive": true,
#     "isPrimary": true,
#     "priority": 0,
#     "lastLatencyMs": 145,
#     "uptimePercent30d": 99.87,
#     "totalRequestCount": 1234567,
#     "errorCount": 23,
#     "lastCheckedAt": "2024-02-19T10:00:00Z"
#   }
# ]

###

### Add RPC Endpoint - Base (Alchemy)
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "chain": "base",
  "url": "https://base-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY",
  "providerName": "Alchemy",
  "isPrimary": true,
  "priority": 0
}

###

### Add RPC Endpoint - Base (LlamaNodes Backup)
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "chain": "base",
  "url": "https://base.llamarpc.com",
  "providerName": "LlamaNodes",
  "isPrimary": false,
  "priority": 1
}

###

### Add RPC Endpoint - Polygon (Alchemy)
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "chain": "polygon",
  "url": "https://polygon-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY",
  "providerName": "Alchemy",
  "isPrimary": true,
  "priority": 0
}

###

### Add RPC Endpoint - Arbitrum (Infura)
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "chain": "arbitrum",
  "url": "https://arbitrum-mainnet.infura.io/v3/YOUR_INFURA_KEY",
  "providerName": "Infura",
  "isPrimary": true,
  "priority": 0
}

###

### Update RPC Endpoint - Deactivate
PATCH {{baseUrl}}/api/v1/blockchain/rpc-endpoints/{endpoint-id}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": false
}

###

### Update RPC Endpoint - Change Priority
PATCH {{baseUrl}}/api/v1/blockchain/rpc-endpoints/{endpoint-id}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "priority": 2
}

###

### Update RPC Endpoint - Make Primary
PATCH {{baseUrl}}/api/v1/blockchain/rpc-endpoints/{endpoint-id}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isPrimary": true,
  "priority": 0
}

###

### Health Check RPC Endpoint
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints/{endpoint-id}/health-check
Authorization: Bearer {{adminToken}}

### Expected Response:
# {
#   "latencyMs": 145,
#   "blockNumber": 18234567,
#   "status": "healthy"
# }

###

### Delete RPC Endpoint (Super Admin Only)
DELETE {{baseUrl}}/api/v1/blockchain/rpc-endpoints/{endpoint-id}
Authorization: Bearer {{superAdminToken}}

###

### ============================================
### ERROR CASES (For Testing)
### ============================================

### Unauthorized - No Token
GET {{baseUrl}}/api/v1/blockchain/monitors

###

### Forbidden - Regular Admin Trying to Add Endpoint
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "chain": "base",
  "url": "https://base.llamarpc.com",
  "providerName": "LlamaNodes",
  "isPrimary": false,
  "priority": 1
}

###

### Bad Request - Short Reason
POST {{baseUrl}}/api/v1/blockchain/monitors/base/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "test"
}

###

### Bad Request - Invalid URL
POST {{baseUrl}}/api/v1/blockchain/rpc-endpoints
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "chain": "base",
  "url": "not-a-valid-url",
  "providerName": "Test",
  "isPrimary": false,
  "priority": 1
}

###

### Not Found - Invalid Chain
POST {{baseUrl}}/api/v1/blockchain/monitors/invalid-chain/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "Testing invalid chain"
}

###

### ============================================
### BULK OPERATIONS (For Setup)
### ============================================

### Setup All Chains - Pause All for Maintenance
POST {{baseUrl}}/api/v1/blockchain/monitors/base/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/polygon/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/celo/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/arbitrum/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/optimism/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/starknet/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/stellar/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###

POST {{baseUrl}}/api/v1/blockchain/monitors/stacks/pause
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "System-wide maintenance window - 2024-02-19 22:00-23:00 UTC"
}

###
